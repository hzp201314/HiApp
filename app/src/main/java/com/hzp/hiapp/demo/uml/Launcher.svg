<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2306px" preserveAspectRatio="none" style="width:1816px;height:2306px;" version="1.1" viewBox="0 0 1816 2306" width="1816.8px" zoomAndPan="magnify"><defs><filter height="300%" id="ff50dzusajkr2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="0.8"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="1.6" dy="1.6" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2262.8992" style="stroke:#A80036;stroke-width:0.4;" width="4" x="211.4" y="21.248"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2137.2711" style="stroke:#A80036;stroke-width:0.4;" width="4" x="273.4" y="146.8762"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2093.5623" style="stroke:#A80036;stroke-width:0.4;" width="4" x="275.4" y="190.585"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2023.5974" style="stroke:#A80036;stroke-width:0.4;" width="4" x="277.4" y="260.5499"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1964.8851" style="stroke:#A80036;stroke-width:0.4;" width="4" x="454.2" y="319.2622"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="543.6213" style="stroke:#A80036;stroke-width:0.4;" width="4" x="456.2" y="1740.526"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="487.2599" style="stroke:#A80036;stroke-width:0.4;" width="4" x="458.2" y="1796.8874"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1916.2254" style="stroke:#A80036;stroke-width:0.4;" width="4" x="668.6" y="367.9219"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1867.5657" style="stroke:#A80036;stroke-width:0.4;" width="4" x="795.8" y="416.5815"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1804.7025" style="stroke:#A80036;stroke-width:0.4;" width="4" x="929" y="479.4447"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1744.7902" style="stroke:#A80036;stroke-width:0.4;" width="4" x="931" y="539.357"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1671.2744" style="stroke:#A80036;stroke-width:0.4;" width="4" x="933" y="612.8729"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="908.7021" style="stroke:#A80036;stroke-width:0.4;" width="4" x="935" y="1375.4451"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1566.4007" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1006.6" y="717.7466"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1468.0287" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1097" y="816.1186"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1401.0146" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1099" y="883.1326"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1277.7865" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1101" y="1006.3607"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1151.0075" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1103" y="1133.1397"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1038.432" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1105" y="1245.7152"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="842.2881" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1177.8" y="1441.8592"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="768.1723" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1179.8" y="1515.975"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="98.372" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1343.4" y="1642.154"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="332.6738" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1410.6" y="1951.4734"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="183.9896" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1412.6" y="2100.1577"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="128.8281" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1611.8" y="2155.3191"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="47.6105" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1613.8" y="2236.5367"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="213.2" x2="213.2" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="275.4" x2="275.4" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="456" x2="456" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="670.6" x2="670.6" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="797.8" x2="797.8" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="931" x2="931" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1008.6" x2="1008.6" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1098.8" x2="1098.8" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1179.6" x2="1179.6" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1345.2" x2="1345.2" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1412.4" x2="1412.4" y1="17.248" y2="2287.7473"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="1613.8" x2="1613.8" y1="17.248" y2="2287.7473"/><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="42" x="191.6" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="36.4" x="194.4" y="11.2176">ZygoteInit.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="42" x="191.6" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="36.4" x="194.4" y="2296.5648">ZygoteInit.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.8" x="248.2" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="47.2" x="251" y="11.2176">SystemServer.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.8" x="248.2" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="47.2" x="251" y="2296.5648">SystemServer.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="76.4" x="417.2" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="70.8" x="420" y="11.2176">ActivityManagerService.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="76.4" x="417.2" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="70.8" x="420" y="2296.5648">ActivityManagerService.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="88.8" x="625.4" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="83.2" x="628.2" y="11.2176">ActivityTaskManagerInternal.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="88.8" x="625.4" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="83.2" x="628.2" y="2296.5648">ActivityTaskManagerInternal.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="88.8" x="752.6" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="83.2" x="755.4" y="11.2176">ActivityTaskManagerService.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="88.8" x="752.6" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="83.2" x="755.4" y="2296.5648">ActivityTaskManagerService.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="72" x="894.2" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="66.4" x="897" y="11.2176">RootActivityContainer.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="72" x="894.2" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="66.4" x="897" y="2296.5648">RootActivityContainer.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="72" x="971.8" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="66.4" x="974.6" y="11.2176">ActivityStartController.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="72" x="971.8" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="66.4" x="974.6" y="2296.5648">ActivityStartController.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.4" x="1072" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="46.8" x="1074.8" y="11.2176">ActivityStarter.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.4" x="1072" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="46.8" x="1074.8" y="2296.5648">ActivityStarter.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="49.2" x="1154.4" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="43.6" x="1157.2" y="11.2176">ActivityStack.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="49.2" x="1154.4" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="43.6" x="1157.2" y="2296.5648">ActivityStack.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="76.4" x="1306.4" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="70.8" x="1309.2" y="11.2176">ActivityStackSupervisor.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="76.4" x="1306.4" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="70.8" x="1309.2" y="2296.5648">ActivityStackSupervisor.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="46.8" x="1388.4" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="41.2" x="1391.2" y="11.2176">ProcessList.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="46.8" x="1388.4" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="41.2" x="1391.2" y="2296.5648">ProcessList.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="55.2" x="1585.4" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="49.6" x="1588.2" y="11.2176">ZygoteProcess.java</text><rect fill="#FEFECE" filter="url(#ff50dzusajkr2)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="55.2" x="1585.4" y="2287.3473"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="49.6" x="1588.2" y="2296.5648">ZygoteProcess.java</text><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2262.8992" style="stroke:#A80036;stroke-width:0.4;" width="4" x="211.4" y="21.248"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2137.2711" style="stroke:#A80036;stroke-width:0.4;" width="4" x="273.4" y="146.8762"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2093.5623" style="stroke:#A80036;stroke-width:0.4;" width="4" x="275.4" y="190.585"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="2023.5974" style="stroke:#A80036;stroke-width:0.4;" width="4" x="277.4" y="260.5499"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1964.8851" style="stroke:#A80036;stroke-width:0.4;" width="4" x="454.2" y="319.2622"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="543.6213" style="stroke:#A80036;stroke-width:0.4;" width="4" x="456.2" y="1740.526"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="487.2599" style="stroke:#A80036;stroke-width:0.4;" width="4" x="458.2" y="1796.8874"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1916.2254" style="stroke:#A80036;stroke-width:0.4;" width="4" x="668.6" y="367.9219"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1867.5657" style="stroke:#A80036;stroke-width:0.4;" width="4" x="795.8" y="416.5815"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1804.7025" style="stroke:#A80036;stroke-width:0.4;" width="4" x="929" y="479.4447"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1744.7902" style="stroke:#A80036;stroke-width:0.4;" width="4" x="931" y="539.357"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1671.2744" style="stroke:#A80036;stroke-width:0.4;" width="4" x="933" y="612.8729"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="908.7021" style="stroke:#A80036;stroke-width:0.4;" width="4" x="935" y="1375.4451"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1566.4007" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1006.6" y="717.7466"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1468.0287" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1097" y="816.1186"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1401.0146" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1099" y="883.1326"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1277.7865" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1101" y="1006.3607"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1151.0075" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1103" y="1133.1397"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="1038.432" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1105" y="1245.7152"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="842.2881" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1177.8" y="1441.8592"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="768.1723" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1179.8" y="1515.975"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="98.372" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1343.4" y="1642.154"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="332.6738" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1410.6" y="1951.4734"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="183.9896" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1412.6" y="2100.1577"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="128.8281" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1611.8" y="2155.3191"/><rect fill="#FFFFFF" filter="url(#ff50dzusajkr2)" height="47.6105" style="stroke:#A80036;stroke-width:0.4;" width="4" x="1613.8" y="2236.5367"/><line style="stroke:#A80036;stroke-width:0.4;" x1="215.4" x2="232.2" y1="79.8621" y2="79.8621"/><line style="stroke:#A80036;stroke-width:0.4;" x1="232.2" x2="232.2" y1="79.8621" y2="85.0621"/><line style="stroke:#A80036;stroke-width:0.4;" x1="215.8" x2="232.2" y1="85.0621" y2="85.0621"/><polygon fill="#A80036" points="219.8,83.4621,215.8,85.0621,219.8,86.6621,218.2,85.0621" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="218.2" y="77.9195">1</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="222.6" y="77.9195">main()</text><path d="M2,23.248 L2,133.648 L208,133.648 L208,27.248 L204,23.248 L2,23.248 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M204,23.248 L204,27.248 L208,27.248 L204,23.248 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="4.4" y="31.2072">ZygoteInit.java 819</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="85.2" x="4.4" y="38.309">public static void main(String argv[]) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="126.4" x="10.8" y="45.4107">//1.系统资源预加载 877 preload(bootTimingsTraceLog);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88" x="10.8" y="52.5125">preloadClasses();//加载系统Class文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="91.2" x="10.8" y="59.6143">preloadResources();//加载系统资源文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="97.2" x="10.8" y="66.716">preloadSharedLibraries();//加载系统动态库</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="191.2" x="10.8" y="73.8178">//2.启动system_server进程。SystemServer进程是Android Framework的核心进程。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="90.8" x="10.8" y="80.9195">if(argv[1].equals("start-system-server")){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="17.2" y="88.0213">startSystemServer();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="10.8" y="95.123">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="172.8" x="10.8" y="102.2248">//3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54" x="10.8" y="109.3266">registerZygoteSocket();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="160.4" x="10.8" y="116.4283">//4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="50.8" x="10.8" y="123.5301">runSelectLoopMode();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="4.4" y="130.6318">}</text><polygon fill="#A80036" points="268.6,145.2762,272.6,146.8762,268.6,148.4762,270.2,146.8762" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="215.4" x2="271" y1="146.8762" y2="146.8762"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="218.2" y="144.9336">2</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="46" x="222.6" y="144.9336">startSystemServer()</text><line style="stroke:#A80036;stroke-width:0.4;" x1="277.4" x2="296.2" y1="185.385" y2="185.385"/><line style="stroke:#A80036;stroke-width:0.4;" x1="296.2" x2="296.2" y1="185.385" y2="190.585"/><line style="stroke:#A80036;stroke-width:0.4;" x1="279.8" x2="296.2" y1="190.585" y2="190.585"/><polygon fill="#A80036" points="283.8,188.985,279.8,190.585,283.8,192.185,282.2,190.585" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="282.2" y="183.4424">3</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="77.6" x="286.6" y="183.4424">main()-&gt;new SystemServer().run()</text><path d="M167.2,152.0762 L167.2,219.6762 L269.6,219.6762 L269.6,156.0762 L265.6,152.0762 L167.2,152.0762 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M265.6,152.0762 L265.6,156.0762 L269.6,156.0762 L265.6,152.0762 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="94" x="169.6" y="160.0354">SystemServer.java main():348-&gt;run():370</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="44.4" x="169.6" y="167.1371">private void main() {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54.4" x="176" y="174.2389">//1.启动引导服务17 510</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="57.2" x="176" y="181.3406">startBootstrapServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="51.6" x="176" y="188.4424">//2.启动核心服务9 511</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="176" y="195.5441">startCoreServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="68" x="176" y="202.6459">//3.启动其他一般服务90+ 512</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="176" y="209.7477">startOtherServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="169.6" y="216.8494">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="279.4" x2="298.2" y1="255.3499" y2="255.3499"/><line style="stroke:#A80036;stroke-width:0.4;" x1="298.2" x2="298.2" y1="255.3499" y2="260.5499"/><line style="stroke:#A80036;stroke-width:0.4;" x1="281.8" x2="298.2" y1="260.5499" y2="260.5499"/><polygon fill="#A80036" points="285.8,258.9499,281.8,260.5499,285.8,262.1499,284.2,260.5499" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="284.2" y="253.4073">4</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="46" x="288.6" y="253.4073">startOtherServices()</text><path d="M155.2,225.592 L155.2,286.392 L269.6,286.392 L269.6,229.592 L265.6,225.592 L155.2,225.592 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M265.6,225.592 L265.6,229.592 L269.6,229.592 L265.6,225.592 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="157.6" y="233.5512">SystemServer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="66.8" x="157.6" y="240.6529">//启动其他一般服务(90+) 877</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="157.6" y="247.7547">startOtherServices(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="164" y="254.8564">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="78.8" x="164" y="261.9582">//启动Launcher应用入口方法 2035</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="99.6" x="164" y="269.06">mActivityManagerService.systemReady(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="164" y="276.1617">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="157.6" y="283.2635">}</text><polygon fill="#A80036" points="449.4,317.6622,453.4,319.2622,449.4,320.8622,451,319.2622" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="281.4" x2="451.8" y1="319.2622" y2="319.2622"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="284.2" y="317.3196">5</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="160.8" x="288.6" y="317.3196">mActivityManagerService.systemReady()//启动Launcher应用入口方法</text><path d="M460,292.0061 L460,338.4061 L638.8,338.4061 L638.8,296.0061 L634.8,292.0061 L460,292.0061 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M634.8,292.0061 L634.8,296.0061 L638.8,296.0061 L634.8,292.0061 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="64" x="462.4" y="299.9652">ActivityManagerService.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="78.8" x="462.4" y="307.067">//启动Launcher应用入口方法 8960</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38.4" x="462.4" y="314.1688">systemReady() {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.2" x="468.8" y="321.2705">//启动桌面应用 9076</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="164" x="468.8" y="328.3723">mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="462.4" y="335.474">}</text><polygon fill="#A80036" points="663.8,366.3219,667.8,367.9219,663.8,369.5219,665.4,367.9219" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="458.2" x2="666.2" y1="367.9219" y2="367.9219"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="461" y="365.9793">6</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="198.4" x="465.4" y="365.9793">mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");//启动桌面应用</text><path d="M674.4,344.2166 L674.4,383.4166 L798.8,383.4166 L798.8,348.2166 L794.8,344.2166 L674.4,344.2166 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M794.8,344.2166 L794.8,348.2166 L798.8,348.2166 L794.8,344.2166 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="76.8" x="676.8" y="352.1758">ActivityTaskManagerInternal.java:</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60.4" x="676.8" y="359.2775">//在所有屏幕启动桌面应用</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="116" x="676.8" y="366.3793">abstract startHomeOnAllDisplays();//抽象方法 442</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="108.8" x="676.8" y="373.4811">ActivityTaskManagerService$LocalService.java:</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="93.2" x="676.8" y="380.5828">startHomeOnAllDisplays();//实现类 6692</text><polygon fill="#A80036" points="791,414.9815,795,416.5815,791,418.1815,792.6,416.5815" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="672.6" x2="793.4" y1="416.5815" y2="416.5815"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="675.4" y="414.639">7</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="111.2" x="679.8" y="414.639">LocalService:startHomeOnAllDisplays();//实现类</text><path d="M801.6,389.3254 L801.6,435.7254 L961.2,435.7254 L961.2,393.3254 L957.2,389.3254 L801.6,389.3254 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M957.2,389.3254 L957.2,393.3254 L961.2,393.3254 L957.2,389.3254 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="107.2" x="804" y="397.2846">ActivityTaskManagerService$LocalService.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="62.8" x="804" y="404.3863">//在所有屏幕启动应用 6692</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="61.6" x="804" y="411.4881">startHomeOnAllDisplays(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="144.8" x="810.4" y="418.5898">//委托给mRootActivityContainer.startHomeOnAllDisplays()方法</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="117.2" x="810.4" y="425.6916">mRootActivityContainer.startHomeOnAllDisplays();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="804" y="432.7934">}</text><polygon fill="#A80036" points="924.2,477.8447,928.2,479.4447,924.2,481.0447,925.8,479.4447" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="799.8" x2="926.6" y1="479.4447" y2="479.4447"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="802.6" y="477.5021">8</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="117.2" x="807" y="477.5021">mRootActivityContainer.startHomeOnAllDisplays();</text><path d="M934.8,441.5359 L934.8,509.1359 L1102.4,509.1359 L1102.4,445.5359 L1098.4,441.5359 L934.8,441.5359 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1098.4,441.5359 L1098.4,445.5359 L1102.4,445.5359 L1098.4,441.5359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="937.2" y="449.4951">RootActivityContainer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="937.2" y="456.5969">//在所有屏幕启动应用 332</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="61.6" x="937.2" y="463.6986">startHomeOnAllDisplays(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="106" x="943.6" y="470.8004">//遍历所有屏幕取出屏幕id，依次启动桌面应用</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="116" x="943.6" y="477.9021">for (int i = mActivityDisplays.size() - 1; i &gt;= 0; i--) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="128" x="950" y="485.0039">final int displayId = mActivityDisplays.get(i).mDisplayId;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="146.4" x="950" y="492.1057">homeStarted |= startHomeOnDisplay(userId, reason, displayId);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="943.6" y="499.2074">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="937.2" y="506.3092">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="933" x2="951.8" y1="534.157" y2="534.157"/><line style="stroke:#A80036;stroke-width:0.4;" x1="951.8" x2="951.8" y1="534.157" y2="539.357"/><line style="stroke:#A80036;stroke-width:0.4;" x1="935.4" x2="951.8" y1="539.357" y2="539.357"/><polygon fill="#A80036" points="939.4,537.757,935.4,539.357,939.4,540.957,937.8,539.357" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="937.8" y="532.2145">9</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="52.8" x="942.2" y="532.2145">startHomeOnDisplay();</text><path d="M838,515.0518 L838,554.2518 L925.2,554.2518 L925.2,519.0518 L921.2,515.0518 L838,515.0518 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M921.2,515.0518 L921.2,519.0518 L925.2,519.0518 L921.2,515.0518 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="840.4" y="523.0109">RootActivityContainer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="39.2" x="840.4" y="530.1127">//什么也没做 350</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="840.4" y="537.2145">startHomeOnDisplay(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="72.4" x="846.8" y="544.3162">return startHomeOnDisplay(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="840.4" y="551.418">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="935" x2="953.8" y1="607.6729" y2="607.6729"/><line style="stroke:#A80036;stroke-width:0.4;" x1="953.8" x2="953.8" y1="607.6729" y2="612.8729"/><line style="stroke:#A80036;stroke-width:0.4;" x1="937.4" x2="953.8" y1="612.8729" y2="612.8729"/><polygon fill="#A80036" points="941.4,611.2729,937.4,612.8729,941.4,614.4729,939.8,612.8729" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="939.8" y="605.7303">10</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="52.8" x="947" y="605.7303">startHomeOnDisplay();</text><path d="M690.4,560.1605 L690.4,656.1605 L925.2,656.1605 L925.2,564.1605 L921.2,560.1605 L690.4,560.1605 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M921.2,560.1605 L921.2,564.1605 L925.2,564.1605 L921.2,560.1605 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="692.8" y="568.1197">RootActivityContainer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="13.2" x="692.8" y="575.2215">// 366</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="52.8" x="692.8" y="582.3232">startHomeOnDisplay(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="13.2" x="699.2" y="589.425">// 375</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88.4" x="699.2" y="596.5268">if (displayId == DEFAULT_DISPLAY) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="173.6" x="705.6" y="603.6285">// intent.addCategory(Intent.CATEGORY_HOME);=&gt;作为Launcher应用标识</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="163.2" x="705.6" y="610.7303">Intent homeIntent = mService.getHomeIntent();//创建Launcher应用意图</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="201.6" x="705.6" y="617.832">ActivityInfo aInfo = resolveHomeActivity(userId, homeIntent);//获取Activity中Minifest配置</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="699.2" y="624.9338">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="694.4" y="632.0355"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="699.2" y="639.1373">//402</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="220" x="699.2" y="646.2391">mService.getActivityStartController().startHomeActivity(homeIntent, aInfo, myReason,displayId);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="692.8" y="653.3408">}</text><polygon fill="#A80036" points="1001.8,716.1466,1005.8,717.7466,1001.8,719.3466,1003.4,717.7466" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="937" x2="1004.2" y1="717.7466" y2="717.7466"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="939.8" y="715.804">11</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="947" y="715.804">startHomeActivity();</text><path d="M714.4,662.0834 L714.4,765.2834 L925.2,765.2834 L925.2,666.0834 L921.2,662.0834 L714.4,662.0834 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M921.2,662.0834 L921.2,666.0834 L925.2,666.0834 L921.2,662.0834 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60.4" x="716.8" y="670.0426">ActivityStartController.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="160.4" x="716.8" y="677.1443">ActivityStartController这个类的作用是配置Activity启动前的一些信息，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="94.8" x="716.8" y="684.2461">并且把信息传递给ActivityStarter去做启动</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="716.8" y="691.3479">//171</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="716.8" y="698.4496">startHomeActivity(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="723.2" y="705.5514">//181</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="182.4" x="723.2" y="712.6531">//把Activity信息传递给ActivityStarter去做启动,触发ActivityStarter.execute()方法</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="196" x="723.2" y="719.7549">mLastHomeActivityStartResult = obtainStarter(intent, "startHomeActivity: " + reason)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70.8" x="742.4" y="726.8566">.setOutActivity(tmpOutRecord)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38" x="742.4" y="733.9584">.setCallingUid(0)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="742.4" y="741.0602">.setActivityInfo(aInfo)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88.8" x="742.4" y="748.1619">.setActivityOptions(options.toBundle())</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="24.8" x="742.4" y="755.2637">.execute();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="716.8" y="762.3654">}</text><polygon fill="#A80036" points="1092.2,814.5186,1096.2,816.1186,1092.2,817.7186,1093.8,816.1186" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1010.6" x2="1094.6" y1="816.1186" y2="816.1186"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1013.4" y="814.176">12</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="65.6" x="1020.6" y="814.176">obtainStarter(...)...execute();</text><path d="M1102.8,771.108 L1102.8,853.108 L1263.6,853.108 L1263.6,775.108 L1259.6,771.108 L1102.8,771.108 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1259.6,771.108 L1259.6,775.108 L1263.6,775.108 L1259.6,771.108 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="1105.2" y="779.0672">ActivityStarter.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="1105.2" y="786.1689">//509</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="32" x="1105.2" y="793.2707">int execute() {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="146" x="1111.6" y="800.3725">//在ActivityStartController中没有对mRequest.mayWait做配置，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="106.4" x="1111.6" y="807.4742">//所以mRequest.mayWait=null。走else分支。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56.4" x="1111.6" y="814.576">if (mRequest.mayWait) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="72.4" x="1118" y="821.6777">return startActivityMayWait(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="16" x="1111.6" y="828.7795">} else {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="51.6" x="1118" y="835.8813">return startActivity(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1111.6" y="842.983">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1105.2" y="850.0848">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1101" x2="1119.8" y1="877.9326" y2="877.9326"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1119.8" x2="1119.8" y1="877.9326" y2="883.1326"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1103.4" x2="1119.8" y1="883.1326" y2="883.1326"/><polygon fill="#A80036" points="1107.4,881.5326,1103.4,883.1326,1107.4,884.7326,1105.8,883.1326" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1105.8" y="875.99">13</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="1113" y="875.99">startActivity(...);</text><path d="M970.4,858.8273 L970.4,898.0273 L1093.2,898.0273 L1093.2,862.8273 L1089.2,858.8273 L970.4,858.8273 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1089.2,858.8273 L1089.2,862.8273 L1093.2,862.8273 L1089.2,858.8273 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="972.8" y="866.7865">ActivityStarter.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="114.4" x="972.8" y="873.8883">这个方法什么也没做,继续调用startActivity(...) 566</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="972.8" y="880.99">startActivity(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="98.8" x="979.2" y="888.0918">mLastStartActivityResult = startActivity(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="972.8" y="895.1936">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1103" x2="1121.8" y1="1001.1607" y2="1001.1607"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1121.8" x2="1121.8" y1="1001.1607" y2="1006.3607"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1105.4" x2="1121.8" y1="1006.3607" y2="1006.3607"/><polygon fill="#A80036" points="1109.4,1004.7607,1105.4,1006.3607,1109.4,1007.9607,1107.8,1006.3607" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1107.8" y="999.2182">14</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="1115" y="999.2182">startActivity(...);</text><path d="M874,903.9361 L874,1099.5361 L1093.2,1099.5361 L1093.2,907.9361 L1089.2,903.9361 L874,903.9361 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1089.2,903.9361 L1089.2,907.9361 L1093.2,907.9361 L1089.2,903.9361 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="876.4" y="911.8953">ActivityStarter.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="164.4" x="876.4" y="918.9971">//检查Activity是否在清单文件注册，Activity对应的java类是否存在... 611</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="876.4" y="926.0988">startActivity(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="68" x="882.8" y="933.2006">// 本次启动Activity返回值 621</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="104" x="882.8" y="940.3023">int err = ActivityManager.START_SUCCESS;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="171.2" x="882.8" y="947.4041">//IApplicationThread caller 此时Launcher未创建成功 caller=null 进不去 627</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38.4" x="882.8" y="954.5059">if (caller != null) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="889.2" y="961.6076">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="126" x="889.2" y="968.7094">err = ActivityManager.START_PERMISSION_DENIED;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="882.8" y="975.8111">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="156.4" x="882.8" y="982.9129">//intent.getComponent()=null:Activity没有在清单文件注册的时候 695</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="188" x="882.8" y="990.0146">if (err == ActivityManager.START_SUCCESS &amp;&amp; intent.getComponent() == null) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="133.6" x="889.2" y="997.1164">err = ActivityManager.START_INTENT_NOT_RESOLVED;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="882.8" y="1004.2182">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="878" y="1011.3199"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="204.4" x="882.8" y="1018.4217">//aInfo=null:Activity注册在清单文件，但对应的清单文件不存在，启动之前的安全校验 701</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="147.6" x="882.8" y="1025.5234">if (err == ActivityManager.START_SUCCESS &amp;&amp; aInfo == null) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="122.8" x="889.2" y="1032.6252">err = ActivityManager.START_CLASS_NOT_FOUND;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="882.8" y="1039.727">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="202.8" x="882.8" y="1046.8287">//禁止后台启动Activity校验(Android9.0开始),shouldAbortBackgroundActivityStart(...) 773</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="129.2" x="882.8" y="1053.9305">//权限校验,&lt;activity android:permission="..."&gt;&lt;/activity&gt;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="140.4" x="882.8" y="1061.0322">//是否可见校验,&lt;activity android:exported="false"&gt;&lt;/activity&gt;</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="8" x="882.8" y="1068.134">//...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="878" y="1075.2357"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="34" x="882.8" y="1082.3375">//方法出口 933</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="66.8" x="882.8" y="1089.4393">final int res = startActivity(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="876.4" y="1096.541">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1105" x2="1123.8" y1="1127.9397" y2="1127.9397"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1123.8" x2="1123.8" y1="1127.9397" y2="1133.1397"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1107.4" x2="1123.8" y1="1133.1397" y2="1133.1397"/><polygon fill="#A80036" points="1111.4,1131.5397,1107.4,1133.1397,1111.4,1134.7397,1109.8,1133.1397" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1109.8" y="1125.9972">15</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="1117" y="1125.9972">startActivity(...);</text><path d="M996.4,1105.2836 L996.4,1151.6836 L1093.2,1151.6836 L1093.2,1109.2836 L1089.2,1105.2836 L996.4,1105.2836 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1089.2,1105.2836 L1089.2,1109.2836 L1093.2,1109.2836 L1089.2,1105.2836 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="998.8" y="1113.2428">ActivityStarter.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="62.8" x="998.8" y="1120.3445">//这个方法什么也没做 1386</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="998.8" y="1127.4463">startActivity(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="16" x="1005.2" y="1134.548">// 1394</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="82" x="1005.2" y="1141.6498">result = startActivityUnchecked(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="998.8" y="1148.7516">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1107" x2="1125.8" y1="1240.5152" y2="1240.5152"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1125.8" x2="1125.8" y1="1240.5152" y2="1245.7152"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1109.4" x2="1125.8" y1="1245.7152" y2="1245.7152"/><polygon fill="#A80036" points="1113.4,1244.1152,1109.4,1245.7152,1113.4,1247.3152,1111.8,1245.7152" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1111.8" y="1238.5727">16</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="58" x="1119" y="1238.5727">startActivityUnchecked();</text><path d="M841.6,1157.4941 L841.6,1324.6941 L1093.2,1324.6941 L1093.2,1161.4941 L1089.2,1157.4941 L841.6,1157.4941 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1089.2,1157.4941 L1089.2,1161.4941 L1093.2,1161.4941 L1089.2,1157.4941 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="844" y="1165.4533">ActivityStarter.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="93.6" x="844" y="1172.5551">//计算Activity启动方式和入栈方式，1464</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="136" x="844" y="1179.6568">//要不要启动新的任务栈,要不要复用栈中已存在的Activity，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70.8" x="844" y="1186.7586">//是否需要回调onNewIntent()...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="58" x="844" y="1193.8604">startActivityUnchecked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="845.6" y="1200.9621"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="122" x="850.4" y="1208.0639">//根据launch mode 和 intent.flag计算Activity入栈方式</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="72.4" x="850.4" y="1215.1656">computeLaunchingTaskFlags();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="72" x="850.4" y="1222.2674">//计算从哪个任务栈启动Activity</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54.8" x="850.4" y="1229.3691">computeSourceStack();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="86.4" x="850.4" y="1236.4709">//从当前任务栈中取出可复用的任务栈</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="136.8" x="850.4" y="1243.5727">ActivityRecord reusedActivity = getReusableIntentActivity();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="850.4" y="1250.6744">//1497</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="58.4" x="850.4" y="1257.7762">if (reusedActivity != null) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="185.2" x="856.8" y="1264.8779">//如果当前任务栈中存在可以复用的ActivityRecord，就执行Activity.onNewIntent()</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="104.8" x="856.8" y="1271.9797">// onNewIntent 入栈还未创建，不会显示 1565</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="49.2" x="856.8" y="1279.0814">deliverNewIntent(top);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="16" x="850.4" y="1286.1832">} else {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="845.6" y="1293.285"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="850.4" y="1300.3867">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="82.8" x="850.4" y="1307.4885">//方法出口，启动栈顶Activity [1728]</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="236.8" x="850.4" y="1314.5902">mRootActivityContainer.resumeFocusedStacksTopActivities(mTargetStack, mStartActivity, mOptions);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="844" y="1321.692">}</text><polygon fill="#A80036" points="943.4,1373.8451,939.4,1375.4451,943.4,1377.0451,941.8,1375.4451" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="941" x2="1104.6" y1="1375.4451" y2="1375.4451"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="945.8" y="1373.5025">17</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="143.2" x="953" y="1373.5025">mRootActivityContainer.resumeFocusedStacksTopActivities();</text><path d="M726.8,1330.4346 L726.8,1412.4346 L925.2,1412.4346 L925.2,1334.4346 L921.2,1330.4346 L726.8,1330.4346 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M921.2,1330.4346 L921.2,1334.4346 L925.2,1334.4346 L921.2,1330.4346 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="60" x="729.2" y="1338.3938">RootActivityContainer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="53.6" x="729.2" y="1345.4955">//启动栈顶Activity 1148</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="87.6" x="729.2" y="1352.5973">resumeFocusedStacksTopActivities(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="148" x="735.6" y="1359.699">//Activity还未创建成功，不会显示resumedOnDisplay=false 1185</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="55.6" x="735.6" y="1366.8008">if (!resumedOnDisplay) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="144.4" x="742" y="1373.9025">final ActivityStack focusedStack = display.getFocusedStack();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="57.6" x="742" y="1381.0043">if (focusedStack != null) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="170.8" x="748.4" y="1388.1061">focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="742" y="1395.2078">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="735.6" y="1402.3096">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="729.2" y="1409.4113">}</text><polygon fill="#A80036" points="1173,1440.2592,1177,1441.8592,1173,1443.4592,1174.6,1441.8592" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="939" x2="1175.4" y1="1441.8592" y2="1441.8592"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="941.8" y="1439.9166">18</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="170.8" x="949" y="1439.9166">focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);</text><path d="M1183.6,1418.1539 L1183.6,1457.3539 L1322,1457.3539 L1322,1422.1539 L1318,1418.1539 L1183.6,1418.1539 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1318,1418.1539 L1318,1422.1539 L1322,1422.1539 L1318,1418.1539 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="40.8" x="1186" y="1426.1131">ActivityStack.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="62.8" x="1186" y="1433.2148">//这个方法什么也没做 2565</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="90" x="1186" y="1440.3166">resumeTopActivityUncheckedLocked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="123.6" x="1192.4" y="1447.4184">result = resumeTopActivityInnerLocked(prev, options);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1186" y="1454.5201">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1181.8" x2="1200.6" y1="1510.775" y2="1510.775"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1200.6" x2="1200.6" y1="1510.775" y2="1515.975"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1184.2" x2="1200.6" y1="1515.975" y2="1515.975"/><polygon fill="#A80036" points="1188.2,1514.375,1184.2,1515.975,1188.2,1517.575,1186.6,1515.975" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1186.6" y="1508.8324">19</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="75.2" x="1193.8" y="1508.8324">resumeTopActivityInnerLocked();</text><path d="M975.2,1463.2627 L975.2,1559.2627 L1174,1559.2627 L1174,1467.2627 L1170,1463.2627 L975.2,1463.2627 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1170,1463.2627 L1170,1467.2627 L1174,1467.2627 L1170,1463.2627 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="40.8" x="977.6" y="1471.2219">ActivityStack.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="190.4" x="977.6" y="1478.3236">//在启动新的Activity之前，把当前处于可见Activity给暂停掉Activity.onPause() 2614</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="75.2" x="977.6" y="1485.4254">resumeTopActivityInnerLocked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70" x="984" y="1492.5271">//得到栈顶ActivityRecord 2623</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="169.2" x="984" y="1499.6289">ActivityRecord next = topRunningActivityLocked(true /* focusableOnly */);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="165.2" x="984" y="1506.7307">//待启动的Activity进程是否存在，Launcher应用进程未创建-&gt;else [2873]</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70" x="984" y="1513.8324">if (next.attachedToProcess()) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="990.4" y="1520.9342">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="12.8" x="984" y="1528.0359">}else{</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="990.4" y="1535.1377">//3037</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="144.8" x="990.4" y="1542.2395">mStackSupervisor.startSpecificActivityLocked(next, true, true);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="984" y="1549.3412">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="977.6" y="1556.443">}</text><polygon fill="#A80036" points="1338.6,1640.554,1342.6,1642.154,1338.6,1643.754,1340.2,1642.154" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1183.8" x2="1341" y1="1642.154" y2="1642.154"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1186.6" y="1640.2114">20</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="144.8" x="1193.8" y="1640.2114">mStackSupervisor.startSpecificActivityLocked(next, true, true);</text><path d="M1349.2,1565.1855 L1349.2,1711.1855 L1618.4,1711.1855 L1618.4,1569.1855 L1614.4,1565.1855 L1349.2,1565.1855 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1614.4,1565.1855 L1614.4,1569.1855 L1618.4,1569.1855 L1614.4,1565.1855 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="64.8" x="1351.6" y="1573.1447">ActivityStackSupervisor.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="1351.6" y="1580.2465">//956</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="67.2" x="1351.6" y="1587.3482">startSpecificActivityLocked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="108.4" x="1358" y="1594.45">//再次校验Activity应用进程是否创建，双重校验</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="29.2" x="1358" y="1601.5518">//进程控制器</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="106" x="1358" y="1608.6535">// Is this activity's application already running?</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="254.4" x="1358" y="1615.7553">final WindowProcessController wpc =mService.getProcessController(r.processName, r.info.applicationInfo.uid);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="76.4" x="1358" y="1622.857">//Launcher应用未启动分支进不去</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="83.6" x="1358" y="1629.9588">if (wpc != null &amp;&amp; wpc.hasThread()) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="61.6" x="1364.4" y="1637.0605">//真正启动Activity流程分支</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="134.4" x="1364.4" y="1644.1623">realStartActivityLocked(r, wpc, andResume, checkConfig);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1358" y="1651.2641">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="1353.2" y="1658.3658"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="126.8" x="1358" y="1665.4676">//::解决java8不能把方法作为另一个方法的入参问题 990</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="214.4" x="1358" y="1672.5693">//ActivityManagerInternal::startProcess-&gt;ActivityManagerService$LocalService.startProcess()</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="122.8" x="1358" y="1679.6711">final Message msg = PooledLambda.obtainMessage(</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="181.6" x="1370.8" y="1686.7729">ActivityManagerInternal::startProcess, mService.mAmInternal, r.processName,</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="171.6" x="1370.8" y="1693.8746">r.info.applicationInfo, knownToBeDead, "activity", r.intent.getComponent());</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="79.6" x="1358" y="1700.9764">mService.mH.sendMessage(msg);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1351.6" y="1708.0781">}</text><polygon fill="#A80036" points="464.6,1738.926,460.6,1740.526,464.6,1742.126,463,1740.526" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="462.2" x2="1345" y1="1740.526" y2="1740.526"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="467" y="1738.5834">21</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="117.2" x="474.2" y="1738.5834">LocalService:ActivityManagerInternal::startProcess</text><path d="M346,1716.8207 L346,1756.0207 L450.4,1756.0207 L450.4,1720.8207 L446.4,1716.8207 L346,1716.8207 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M446.4,1716.8207 L446.4,1720.8207 L450.4,1720.8207 L446.4,1716.8207 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="96" x="348.4" y="1724.7799">ActivityManagerService$LocalService.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="68.8" x="348.4" y="1731.8816">//这个方法什么也没做 [18400]</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="34.4" x="348.4" y="1738.9834">startProcess(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54.4" x="354.8" y="1746.0852">startProcessLocked(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="348.4" y="1753.1869">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="460.2" x2="479" y1="1791.6874" y2="1791.6874"/><line style="stroke:#A80036;stroke-width:0.4;" x1="479" x2="479" y1="1791.6874" y2="1796.8874"/><line style="stroke:#A80036;stroke-width:0.4;" x1="462.6" x2="479" y1="1796.8874" y2="1796.8874"/><polygon fill="#A80036" points="466.6,1795.2874,462.6,1796.8874,466.6,1798.4874,465,1796.8874" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="465" y="1789.7448">22</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="49.6" x="472.2" y="1789.7448">startProcessLocked()</text><path d="M282.8,1761.9295 L282.8,1822.7295 L450.4,1822.7295 L450.4,1765.9295 L446.4,1761.9295 L282.8,1761.9295 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M446.4,1761.9295 L446.4,1765.9295 L450.4,1765.9295 L446.4,1761.9295 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="64" x="285.2" y="1769.8887">ActivityManagerService.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="59.6" x="285.2" y="1776.9904">这个方法什么也没做 3022</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="285.2" y="1784.0922">startProcessLocked(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88.8" x="291.6" y="1791.1939">// 把进程创建工作委派给processList，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="152.8" x="291.6" y="1798.2957">// 老版本中进程创建是在AMS中，由于AMS过于臃肿，将其改造。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="74" x="291.6" y="1805.3975">// ProcessList专门负责进程创建</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="104.4" x="291.6" y="1812.4992">return mProcessList.startProcessLocked(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="285.2" y="1819.601">}</text><polygon fill="#A80036" points="1405.8,1949.8734,1409.8,1951.4734,1405.8,1953.0734,1407.4,1951.4734" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="462.2" x2="1408.2" y1="1951.4734" y2="1951.4734"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="465" y="1949.5309">23</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="83.2" x="472.2" y="1949.5309">mProcessList.startProcessLocked()</text><path d="M1416.4,1828.3436 L1416.4,2066.3436 L1742,2066.3436 L1742,1832.3436 L1738,1828.3436 L1416.4,1828.3436 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1738,1828.3436 L1738,1832.3436 L1742,1832.3436 L1738,1828.3436 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38" x="1418.8" y="1836.3027">ProcessList.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="89.6" x="1418.8" y="1843.4045">//有一个非常重要参数entryPoint [1619]</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="143.2" x="1418.8" y="1850.5063">//创建进程时强制指定entryPoint="android.app.ActivityThread",</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="214" x="1418.8" y="1857.608">//进程创建完成以后新进程入口，所有Android应用的入口是ActivityThread，并不是Application</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="122.4" x="1418.8" y="1864.7098">final String entryPoint = "android.app.ActivityThread";</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="1420.4" y="1871.8115"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="138.8" x="1418.8" y="1878.9133">//进程创建之前配置必要参数，如：API类型，版本号。 1849</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="51.2" x="1418.8" y="1886.015">startProcessLocked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="30.4" x="1425.2" y="1893.1168">//1953-&gt;1842</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="181.2" x="1425.2" y="1900.2186">final boolean success = startProcessLocked(app, hostingRecord, abiOverride);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1418.8" y="1907.3203">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="1418.8" y="1914.4221">//1842</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="51.2" x="1418.8" y="1921.5238">startProcessLocked(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="30.4" x="1425.2" y="1928.6256">//1844-&gt;1428</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70.8" x="1425.2" y="1935.7273">return startProcessLocked(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1418.8" y="1942.8291">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="1418.8" y="1949.9309">//1428</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="1418.8" y="1957.0326">startProcessLocked(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="30.4" x="1425.2" y="1964.1344">//1621-&gt;1640</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="70.8" x="1425.2" y="1971.2361">return startProcessLocked(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1418.8" y="1978.3379">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="1418.8" y="1985.4396">//1640</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="1418.8" y="1992.5414">startProcessLocked(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="30.4" x="1425.2" y="1999.6432">//1689-&gt;1798</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="149.2" x="1425.2" y="2006.7449">final Process.ProcessStartResult startResult = startProcess(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1418.8" y="2013.8467">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="0" x="1420.4" y="2020.9484"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="164" x="1418.8" y="2028.0502">//创建进程完毕以后进入ZygoteProcess，此时还处于SystemServer进程</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="190.4" x="1418.8" y="2035.152">//ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="317.2" x="1418.8" y="2042.2537">//openZygoteSocketIfNeeded(abi)创建本地Socket对象并且连接Zygote进程Socket服务。然后通过字符输入流把创建进程必备参数发送过去</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="250.4" x="1418.8" y="2049.3555">//进程创建完毕后根据新进程传递的入口类由ZygoteInit反射执行。下面进入安卓应用进程入口类ActivityThread</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.2" x="1418.8" y="2056.4572">ZygoteProcess.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="216" x="1418.8" y="2063.559">zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1414.6" x2="1433.4" y1="2094.9577" y2="2094.9577"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1433.4" x2="1433.4" y1="2094.9577" y2="2100.1577"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1417" x2="1433.4" y1="2100.1577" y2="2100.1577"/><polygon fill="#A80036" points="1421,2098.5577,1417,2100.1577,1421,2101.7577,1419.4,2100.1577" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1419.4" y="2093.0151">24</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="149.2" x="1426.6" y="2093.0151">final Process.ProcessStartResult startResult = startProcess(...);</text><path d="M1285.2,2072.3016 L1285.2,2118.7016 L1406.8,2118.7016 L1406.8,2076.3016 L1402.8,2072.3016 L1285.2,2072.3016 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1402.8,2072.3016 L1402.8,2076.3016 L1406.8,2076.3016 L1402.8,2072.3016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38" x="1287.6" y="2080.2607">ProcessList.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="1287.6" y="2087.3625">//1798</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="34.4" x="1287.6" y="2094.4643">startProcess(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="17.6" x="1294" y="2101.566">//[1816]</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="106.8" x="1294" y="2108.6678">startResult = appZygote.getProcess().start(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1287.6" y="2115.7695">}</text><polygon fill="#A80036" points="1607,2153.7191,1611,2155.3191,1607,2156.9191,1608.6,2155.3191" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1416.6" x2="1609.4" y1="2155.3191" y2="2155.3191"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1419.4" y="2153.3766">25</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="180.4" x="1426.6" y="2153.3766">final Process.ProcessStartResult startResult = appZygote.getProcess().start()</text><path d="M1617.6,2124.5121 L1617.6,2178.1121 L1813.2,2178.1121 L1813.2,2128.5121 L1809.2,2124.5121 L1617.6,2124.5121 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1809.2,2124.5121 L1809.2,2128.5121 L1813.2,2128.5121 L1809.2,2124.5121 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.2" x="1620" y="2132.4713">ZygoteProcess.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="187.2" x="1620" y="2139.573">ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="1620" y="2146.6748">//314</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="20" x="1620" y="2153.7766">start(...){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="24.8" x="1626.4" y="2160.8783">//333-&gt;541</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="58" x="1626.4" y="2167.9801">return startViaZygote(...);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1620" y="2175.0818">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="1615.8" x2="1634.6" y1="2231.3367" y2="2231.3367"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1634.6" x2="1634.6" y1="2231.3367" y2="2236.5367"/><line style="stroke:#A80036;stroke-width:0.4;" x1="1618.2" x2="1634.6" y1="2236.5367" y2="2236.5367"/><polygon fill="#A80036" points="1622.2,2234.9367,1618.2,2236.5367,1622.2,2238.1367,1620.6,2236.5367" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="1620.6" y="2229.3941">26</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="36.8" x="1627.8" y="2229.3941">startViaZygote()</text><path d="M1356,2183.8244 L1356,2279.8244 L1608,2279.8244 L1608,2187.8244 L1604,2183.8244 L1356,2183.8244 " fill="#FBFB77" filter="url(#ff50dzusajkr2)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M1604,2183.8244 L1604,2187.8244 L1608,2187.8244 L1604,2183.8244 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.2" x="1358.4" y="2191.7836">ZygoteProcess.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="1358.4" y="2198.8854">//541</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38.4" x="1358.4" y="2205.9871">startViaZygote(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="52.8" x="1364.8" y="2213.0889">synchronized(mLock) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="78" x="1371.2" y="2220.1906">// openZygoteSocketIfNeeded(abi)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="119.2" x="1371.2" y="2227.2924">//创建本地Socket对象连接Zygote进程Socket服务，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="119.2" x="1371.2" y="2234.3941">//然后通过字符输入流把创建进程必备参数发送过去,</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="134.8" x="1371.2" y="2241.4959">//进程创建后会根据新进程的入口类由ZygoteInit反射执行，</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="198" x="1371.2" y="2248.5977">//下面就到了Android应用入口类ActvityThread。至此Launcher进程启动流程分析完毕。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="11.6" x="1371.2" y="2255.6994">//635</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="230.8" x="1371.2" y="2262.8012">return zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1364.8" y="2269.9029">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="1358.4" y="2277.0047">}</text><!--MD5=[74bc6089793696e457a0b223ec5caee9]
@startuml
'https://plantuml.com/sequence-diagram

autonumber

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: main()
note left
ZygoteInit.java 819
public static void main(String argv[]) {
    //1.系统资源预加载 877 preload(bootTimingsTraceLog);
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
    //2.启动system_server进程。SystemServer进程是Android Framework的核心进程。
    if(argv[1].equals("start-system-server")){
        startSystemServer();
    }
    //3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求
    registerZygoteSocket();
    //4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。
    runSelectLoopMode();
}
end note

ZygoteInit.java -> SystemServer.java: startSystemServer()
activate SystemServer.java

SystemServer.java -> SystemServer.java:  main()->new SystemServer().run()
activate SystemServer.java
note left
SystemServer.java main():348->run():370
private void main() {
    //1.启动引导服务17 510
    startBootstrapServices();
    //2.启动核心服务9 511
    startCoreServices();
    //3.启动其他一般服务90+ 512
    startOtherServices();
}
end note

SystemServer.java -> SystemServer.java:  startOtherServices()
activate SystemServer.java
note left
SystemServer.java
//启动其他一般服务(90+) 877
startOtherServices(){
    ...
    //启动Launcher应用入口方法 2035
    mActivityManagerService.systemReady(...)
    ...
}
end note

SystemServer.java -> ActivityManagerService.java:  mActivityManagerService.systemReady()//启动Launcher应用入口方法
activate ActivityManagerService.java
note right
ActivityManagerService.java
//启动Launcher应用入口方法 8960
systemReady() {
    //启动桌面应用 9076
    mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");
}
end note

ActivityManagerService.java -> ActivityTaskManagerInternal.java:  mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");//启动桌面应用
activate ActivityTaskManagerInternal.java
note right
 ActivityTaskManagerInternal.java:
 //在所有屏幕启动桌面应用
 abstract startHomeOnAllDisplays();//抽象方法 442
 ActivityTaskManagerService$LocalService.java:
 startHomeOnAllDisplays();//实现类 6692
end note

ActivityTaskManagerInternal.java -> ActivityTaskManagerService.java:  LocalService:startHomeOnAllDisplays();//实现类
activate ActivityTaskManagerService.java
note right
ActivityTaskManagerService$LocalService.java
//在所有屏幕启动应用 6692
startHomeOnAllDisplays(){
    //委托给mRootActivityContainer.startHomeOnAllDisplays()方法
    mRootActivityContainer.startHomeOnAllDisplays();
}
end note

ActivityTaskManagerService.java -> RootActivityContainer.java:  mRootActivityContainer.startHomeOnAllDisplays();
activate RootActivityContainer.java
note right
RootActivityContainer.java
//在所有屏幕启动应用 332
startHomeOnAllDisplays(){
    //遍历所有屏幕取出屏幕id，依次启动桌面应用
    for (int i = mActivityDisplays.size() - 1; i >= 0; i- -) {
        final int displayId = mActivityDisplays.get(i).mDisplayId;
        homeStarted |= startHomeOnDisplay(userId, reason, displayId);
    }
}
end note

RootActivityContainer.java -> RootActivityContainer.java:  startHomeOnDisplay();
activate RootActivityContainer.java
note left
RootActivityContainer.java
//什么也没做 350
startHomeOnDisplay(...)
    return startHomeOnDisplay(...);
}
end note

RootActivityContainer.java -> RootActivityContainer.java:  startHomeOnDisplay();
activate RootActivityContainer.java
note left
RootActivityContainer.java
// 366
startHomeOnDisplay(){
    // 375
    if (displayId == DEFAULT_DISPLAY) {
        // intent.addCategory(Intent.CATEGORY_HOME);=>作为Launcher应用标识
        Intent homeIntent = mService.getHomeIntent();//创建Launcher应用意图
        ActivityInfo aInfo = resolveHomeActivity(userId, homeIntent);//获取Activity中Minifest配置
    }

    //402
    mService.getActivityStartController().startHomeActivity(homeIntent, aInfo, myReason,displayId);
}
end note

RootActivityContainer.java -> ActivityStartController.java:  startHomeActivity();
activate ActivityStartController.java
note left
ActivityStartController.java
ActivityStartController这个类的作用是配置Activity启动前的一些信息，
并且把信息传递给ActivityStarter去做启动
//171
startHomeActivity(){
    //181
    //把Activity信息传递给ActivityStarter去做启动,触发ActivityStarter.execute()方法
    mLastHomeActivityStartResult = obtainStarter(intent, "startHomeActivity: " + reason)
                .setOutActivity(tmpOutRecord)
                .setCallingUid(0)
                .setActivityInfo(aInfo)
                .setActivityOptions(options.toBundle())
                .execute();
}
end note

ActivityStartController.java -> ActivityStarter.java:  obtainStarter(...)...execute();
activate ActivityStarter.java
note right
ActivityStarter.java
//509
int execute() {
    //在ActivityStartController中没有对mRequest.mayWait做配置，
    //所以mRequest.mayWait=null。走else分支。
    if (mRequest.mayWait) {
        return startActivityMayWait(...);
    } else {
        return startActivity(...);
    }
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
这个方法什么也没做,继续调用startActivity(...) 566
startActivity(...){
    mLastStartActivityResult = startActivity(...)
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
//检查Activity是否在清单文件注册，Activity对应的java类是否存在... 611
startActivity(...){
    // 本次启动Activity返回值 621
    int err = ActivityManager.START_SUCCESS;
    //IApplicationThread caller 此时Launcher未创建成功 caller=null 进不去 627
    if (caller != null) {
        ...
        err = ActivityManager.START_PERMISSION_DENIED;
    }
    //intent.getComponent()=null:Activity没有在清单文件注册的时候 695
    if (err == ActivityManager.START_SUCCESS && intent.getComponent() == null) {
        err = ActivityManager.START_INTENT_NOT_RESOLVED;
    }

    //aInfo=null:Activity注册在清单文件，但对应的清单文件不存在，启动之前的安全校验 701
    if (err == ActivityManager.START_SUCCESS && aInfo == null) {
        err = ActivityManager.START_CLASS_NOT_FOUND;
    }
    //禁止后台启动Activity校验(Android9.0开始),shouldAbortBackgroundActivityStart(...) 773
    //权限校验,<activity android:permission="..."></activity>
    //是否可见校验,<activity android:exported="false"></activity>
    //...

    //方法出口 933
    final int res = startActivity(...)
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
//这个方法什么也没做 1386
startActivity(...){
    // 1394
    result = startActivityUnchecked(...);
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivityUnchecked();
activate ActivityStarter.java
note left
ActivityStarter.java
//计算Activity启动方式和入栈方式，1464
//要不要启动新的任务栈,要不要复用栈中已存在的Activity，
//是否需要回调onNewIntent()...
startActivityUnchecked(){

    //根据launch mode 和 intent.flag计算Activity入栈方式
    computeLaunchingTaskFlags();
    //计算从哪个任务栈启动Activity
    computeSourceStack();
    //从当前任务栈中取出可复用的任务栈
    ActivityRecord reusedActivity = getReusableIntentActivity();
    //1497
    if (reusedActivity != null) {
        //如果当前任务栈中存在可以复用的ActivityRecord，就执行Activity.onNewIntent()
        // onNewIntent 入栈还未创建，不会显示 1565
        deliverNewIntent(top);
    } else {

    }
    //方法出口，启动栈顶Activity [1728]
    mRootActivityContainer.resumeFocusedStacksTopActivities(mTargetStack, mStartActivity, mOptions);
}
end note

ActivityStarter.java -> RootActivityContainer.java:  mRootActivityContainer.resumeFocusedStacksTopActivities();
'deactivate ActivityStarter.java
'deactivate ActivityStarter.java
'deactivate ActivityStarter.java
'deactivate ActivityStarter.java
'deactivate ActivityStarter.java
activate RootActivityContainer.java
note left
RootActivityContainer.java
//启动栈顶Activity 1148
resumeFocusedStacksTopActivities(){
    //Activity还未创建成功，不会显示resumedOnDisplay=false 1185
    if (!resumedOnDisplay) {
        final ActivityStack focusedStack = display.getFocusedStack();
        if (focusedStack != null) {
            focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);
        }
    }
}
end note

RootActivityContainer.java -> ActivityStack.java:  focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);
activate ActivityStack.java
note right
ActivityStack.java
//这个方法什么也没做 2565
resumeTopActivityUncheckedLocked(){
    result = resumeTopActivityInnerLocked(prev, options);
}
end note

ActivityStack.java -> ActivityStack.java:  resumeTopActivityInnerLocked();
activate ActivityStack.java
note left
ActivityStack.java
//在启动新的Activity之前，把当前处于可见Activity给暂停掉Activity.onPause() 2614
resumeTopActivityInnerLocked(){
    //得到栈顶ActivityRecord 2623
    ActivityRecord next = topRunningActivityLocked(true /* focusableOnly */);
    //待启动的Activity进程是否存在，Launcher应用进程未创建->else [2873]
    if (next.attachedToProcess()) {
        ...
    }else{
        //3037
        mStackSupervisor.startSpecificActivityLocked(next, true, true);
    }
}
end note

ActivityStack.java -> ActivityStackSupervisor.java:  mStackSupervisor.startSpecificActivityLocked(next, true, true);
activate ActivityStackSupervisor.java
note right
ActivityStackSupervisor.java
//956
startSpecificActivityLocked(){
    //再次校验Activity应用进程是否创建，双重校验
    //进程控制器
    // Is this activity's application already running?
    final WindowProcessController wpc =mService.getProcessController(r.processName, r.info.applicationInfo.uid);
    //Launcher应用未启动分支进不去
    if (wpc != null && wpc.hasThread()) {
        //真正启动Activity流程分支
        realStartActivityLocked(r, wpc, andResume, checkConfig);
    }

    //::解决java8不能把方法作为另一个方法的入参问题 990
    //ActivityManagerInternal::startProcess->ActivityManagerService$LocalService.startProcess()
    final Message msg = PooledLambda.obtainMessage(
            ActivityManagerInternal::startProcess, mService.mAmInternal, r.processName,
            r.info.applicationInfo, knownToBeDead, "activity", r.intent.getComponent());
    mService.mH.sendMessage(msg);
}
end note

ActivityStackSupervisor.java -> ActivityManagerService.java:   LocalService:ActivityManagerInternal::startProcess
deactivate ActivityStackSupervisor.java
activate ActivityManagerService.java
note left
ActivityManagerService$LocalService.java
//这个方法什么也没做 [18400]
startProcess(){
    startProcessLocked(...)
}
end note

ActivityManagerService.java -> ActivityManagerService.java:   startProcessLocked()
activate ActivityManagerService.java
note left
ActivityManagerService.java
这个方法什么也没做 3022
startProcessLocked(...){
    // 把进程创建工作委派给processList，
    // 老版本中进程创建是在AMS中，由于AMS过于臃肿，将其改造。
    // ProcessList专门负责进程创建
    return mProcessList.startProcessLocked(...);
}
end note

ActivityManagerService.java -> ProcessList.java:   mProcessList.startProcessLocked()
activate ProcessList.java
note right
ProcessList.java
//有一个非常重要参数entryPoint [1619]
//创建进程时强制指定entryPoint="android.app.ActivityThread",
//进程创建完成以后新进程入口，所有Android应用的入口是ActivityThread，并不是Application
final String entryPoint = "android.app.ActivityThread";

//进程创建之前配置必要参数，如：API类型，版本号。 1849
startProcessLocked(){
    //1953->1842
    final boolean success = startProcessLocked(app, hostingRecord, abiOverride);
}
//1842
startProcessLocked(){
    //1844->1428
    return startProcessLocked(...);
}
//1428
startProcessLocked(...){
    //1621->1640
    return startProcessLocked(...);
}
//1640
startProcessLocked(...){
    //1689->1798
    final Process.ProcessStartResult startResult = startProcess(...);
}

//创建进程完毕以后进入ZygoteProcess，此时还处于SystemServer进程
//ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。
//openZygoteSocketIfNeeded(abi)创建本地Socket对象并且连接Zygote进程Socket服务。然后通过字符输入流把创建进程必备参数发送过去
//进程创建完毕后根据新进程传递的入口类由ZygoteInit反射执行。下面进入安卓应用进程入口类ActivityThread
ZygoteProcess.java
zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);
end note

ProcessList.java -> ProcessList.java:   final Process.ProcessStartResult startResult = startProcess(...);
activate ProcessList.java
note left
ProcessList.java
//1798
startProcess(){
    //[1816]
    startResult = appZygote.getProcess().start(...)
}
end note

ProcessList.java -> ZygoteProcess.java:   final Process.ProcessStartResult startResult = appZygote.getProcess().start()
activate ZygoteProcess.java
note right
ZygoteProcess.java
ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。
//314
start(...){
    //333->541
    return startViaZygote(...);
}
end note

ZygoteProcess.java -> ZygoteProcess.java:   startViaZygote()
activate ZygoteProcess.java
note left
ZygoteProcess.java
//541
startViaZygote(){
    synchronized(mLock) {
        // openZygoteSocketIfNeeded(abi)
        //创建本地Socket对象连接Zygote进程Socket服务，
        //然后通过字符输入流把创建进程必备参数发送过去,
        //进程创建后会根据新进程的入口类由ZygoteInit反射执行，
        //下面就到了Android应用入口类ActvityThread。至此Launcher进程启动流程分析完毕。
        //635
        return zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);
    }
}
end note

@enduml

@startuml

autonumber

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: main()
note left
ZygoteInit.java 819
public static void main(String argv[]) {
    //1.系统资源预加载 877 preload(bootTimingsTraceLog);
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
    //2.启动system_server进程。SystemServer进程是Android Framework的核心进程。
    if(argv[1].equals("start-system-server")){
        startSystemServer();
    }
    //3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求
    registerZygoteSocket();
    //4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。
    runSelectLoopMode();
}
end note

ZygoteInit.java -> SystemServer.java: startSystemServer()
activate SystemServer.java

SystemServer.java -> SystemServer.java:  main()->new SystemServer().run()
activate SystemServer.java
note left
SystemServer.java main():348->run():370
private void main() {
    //1.启动引导服务17 510
    startBootstrapServices();
    //2.启动核心服务9 511
    startCoreServices();
    //3.启动其他一般服务90+ 512
    startOtherServices();
}
end note

SystemServer.java -> SystemServer.java:  startOtherServices()
activate SystemServer.java
note left
SystemServer.java
//启动其他一般服务(90+) 877
startOtherServices(){
    ...
    //启动Launcher应用入口方法 2035
    mActivityManagerService.systemReady(...)
    ...
}
end note

SystemServer.java -> ActivityManagerService.java:  mActivityManagerService.systemReady()//启动Launcher应用入口方法
activate ActivityManagerService.java
note right
ActivityManagerService.java
//启动Launcher应用入口方法 8960
systemReady() {
    //启动桌面应用 9076
    mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");
}
end note

ActivityManagerService.java -> ActivityTaskManagerInternal.java:  mAtmInternal.startHomeOnAllDisplays(currentUserId, "systemReady");//启动桌面应用
activate ActivityTaskManagerInternal.java
note right
 ActivityTaskManagerInternal.java:
 //在所有屏幕启动桌面应用
 abstract startHomeOnAllDisplays();//抽象方法 442
 ActivityTaskManagerService$LocalService.java:
 startHomeOnAllDisplays();//实现类 6692
end note

ActivityTaskManagerInternal.java -> ActivityTaskManagerService.java:  LocalService:startHomeOnAllDisplays();//实现类
activate ActivityTaskManagerService.java
note right
ActivityTaskManagerService$LocalService.java
//在所有屏幕启动应用 6692
startHomeOnAllDisplays(){
    //委托给mRootActivityContainer.startHomeOnAllDisplays()方法
    mRootActivityContainer.startHomeOnAllDisplays();
}
end note

ActivityTaskManagerService.java -> RootActivityContainer.java:  mRootActivityContainer.startHomeOnAllDisplays();
activate RootActivityContainer.java
note right
RootActivityContainer.java
//在所有屏幕启动应用 332
startHomeOnAllDisplays(){
    //遍历所有屏幕取出屏幕id，依次启动桌面应用
    for (int i = mActivityDisplays.size() - 1; i >= 0; i- -) {
        final int displayId = mActivityDisplays.get(i).mDisplayId;
        homeStarted |= startHomeOnDisplay(userId, reason, displayId);
    }
}
end note

RootActivityContainer.java -> RootActivityContainer.java:  startHomeOnDisplay();
activate RootActivityContainer.java
note left
RootActivityContainer.java
//什么也没做 350
startHomeOnDisplay(...)
    return startHomeOnDisplay(...);
}
end note

RootActivityContainer.java -> RootActivityContainer.java:  startHomeOnDisplay();
activate RootActivityContainer.java
note left
RootActivityContainer.java
// 366
startHomeOnDisplay(){
    // 375
    if (displayId == DEFAULT_DISPLAY) {
        // intent.addCategory(Intent.CATEGORY_HOME);=>作为Launcher应用标识
        Intent homeIntent = mService.getHomeIntent();//创建Launcher应用意图
        ActivityInfo aInfo = resolveHomeActivity(userId, homeIntent);//获取Activity中Minifest配置
    }

    //402
    mService.getActivityStartController().startHomeActivity(homeIntent, aInfo, myReason,displayId);
}
end note

RootActivityContainer.java -> ActivityStartController.java:  startHomeActivity();
activate ActivityStartController.java
note left
ActivityStartController.java
ActivityStartController这个类的作用是配置Activity启动前的一些信息，
并且把信息传递给ActivityStarter去做启动
//171
startHomeActivity(){
    //181
    //把Activity信息传递给ActivityStarter去做启动,触发ActivityStarter.execute()方法
    mLastHomeActivityStartResult = obtainStarter(intent, "startHomeActivity: " + reason)
                .setOutActivity(tmpOutRecord)
                .setCallingUid(0)
                .setActivityInfo(aInfo)
                .setActivityOptions(options.toBundle())
                .execute();
}
end note

ActivityStartController.java -> ActivityStarter.java:  obtainStarter(...)...execute();
activate ActivityStarter.java
note right
ActivityStarter.java
//509
int execute() {
    //在ActivityStartController中没有对mRequest.mayWait做配置，
    //所以mRequest.mayWait=null。走else分支。
    if (mRequest.mayWait) {
        return startActivityMayWait(...);
    } else {
        return startActivity(...);
    }
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
这个方法什么也没做,继续调用startActivity(...) 566
startActivity(...){
    mLastStartActivityResult = startActivity(...)
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
//检查Activity是否在清单文件注册，Activity对应的java类是否存在... 611
startActivity(...){
    // 本次启动Activity返回值 621
    int err = ActivityManager.START_SUCCESS;
    //IApplicationThread caller 此时Launcher未创建成功 caller=null 进不去 627
    if (caller != null) {
        ...
        err = ActivityManager.START_PERMISSION_DENIED;
    }
    //intent.getComponent()=null:Activity没有在清单文件注册的时候 695
    if (err == ActivityManager.START_SUCCESS && intent.getComponent() == null) {
        err = ActivityManager.START_INTENT_NOT_RESOLVED;
    }

    //aInfo=null:Activity注册在清单文件，但对应的清单文件不存在，启动之前的安全校验 701
    if (err == ActivityManager.START_SUCCESS && aInfo == null) {
        err = ActivityManager.START_CLASS_NOT_FOUND;
    }
    //禁止后台启动Activity校验(Android9.0开始),shouldAbortBackgroundActivityStart(...) 773
    //权限校验,<activity android:permission="..."></activity>
    //是否可见校验,<activity android:exported="false"></activity>
    //...

    //方法出口 933
    final int res = startActivity(...)
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivity(...);
activate ActivityStarter.java
note left
ActivityStarter.java
//这个方法什么也没做 1386
startActivity(...){
    // 1394
    result = startActivityUnchecked(...);
}
end note

ActivityStarter.java -> ActivityStarter.java:  startActivityUnchecked();
activate ActivityStarter.java
note left
ActivityStarter.java
//计算Activity启动方式和入栈方式，1464
//要不要启动新的任务栈,要不要复用栈中已存在的Activity，
//是否需要回调onNewIntent()...
startActivityUnchecked(){

    //根据launch mode 和 intent.flag计算Activity入栈方式
    computeLaunchingTaskFlags();
    //计算从哪个任务栈启动Activity
    computeSourceStack();
    //从当前任务栈中取出可复用的任务栈
    ActivityRecord reusedActivity = getReusableIntentActivity();
    //1497
    if (reusedActivity != null) {
        //如果当前任务栈中存在可以复用的ActivityRecord，就执行Activity.onNewIntent()
        // onNewIntent 入栈还未创建，不会显示 1565
        deliverNewIntent(top);
    } else {

    }
    //方法出口，启动栈顶Activity [1728]
    mRootActivityContainer.resumeFocusedStacksTopActivities(mTargetStack, mStartActivity, mOptions);
}
end note

ActivityStarter.java -> RootActivityContainer.java:  mRootActivityContainer.resumeFocusedStacksTopActivities();
activate RootActivityContainer.java
note left
RootActivityContainer.java
//启动栈顶Activity 1148
resumeFocusedStacksTopActivities(){
    //Activity还未创建成功，不会显示resumedOnDisplay=false 1185
    if (!resumedOnDisplay) {
        final ActivityStack focusedStack = display.getFocusedStack();
        if (focusedStack != null) {
            focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);
        }
    }
}
end note

RootActivityContainer.java -> ActivityStack.java:  focusedStack.resumeTopActivityUncheckedLocked(target, targetOptions);
activate ActivityStack.java
note right
ActivityStack.java
//这个方法什么也没做 2565
resumeTopActivityUncheckedLocked(){
    result = resumeTopActivityInnerLocked(prev, options);
}
end note

ActivityStack.java -> ActivityStack.java:  resumeTopActivityInnerLocked();
activate ActivityStack.java
note left
ActivityStack.java
//在启动新的Activity之前，把当前处于可见Activity给暂停掉Activity.onPause() 2614
resumeTopActivityInnerLocked(){
    //得到栈顶ActivityRecord 2623
    ActivityRecord next = topRunningActivityLocked(true /* focusableOnly */);
    //待启动的Activity进程是否存在，Launcher应用进程未创建->else [2873]
    if (next.attachedToProcess()) {
        ...
    }else{
        //3037
        mStackSupervisor.startSpecificActivityLocked(next, true, true);
    }
}
end note

ActivityStack.java -> ActivityStackSupervisor.java:  mStackSupervisor.startSpecificActivityLocked(next, true, true);
activate ActivityStackSupervisor.java
note right
ActivityStackSupervisor.java
//956
startSpecificActivityLocked(){
    //再次校验Activity应用进程是否创建，双重校验
    //进程控制器
    // Is this activity's application already running?
    final WindowProcessController wpc =mService.getProcessController(r.processName, r.info.applicationInfo.uid);
    //Launcher应用未启动分支进不去
    if (wpc != null && wpc.hasThread()) {
        //真正启动Activity流程分支
        realStartActivityLocked(r, wpc, andResume, checkConfig);
    }

    //::解决java8不能把方法作为另一个方法的入参问题 990
    //ActivityManagerInternal::startProcess->ActivityManagerService$LocalService.startProcess()
    final Message msg = PooledLambda.obtainMessage(
            ActivityManagerInternal::startProcess, mService.mAmInternal, r.processName,
            r.info.applicationInfo, knownToBeDead, "activity", r.intent.getComponent());
    mService.mH.sendMessage(msg);
}
end note

ActivityStackSupervisor.java -> ActivityManagerService.java:   LocalService:ActivityManagerInternal::startProcess
deactivate ActivityStackSupervisor.java
activate ActivityManagerService.java
note left
ActivityManagerService$LocalService.java
//这个方法什么也没做 [18400]
startProcess(){
    startProcessLocked(...)
}
end note

ActivityManagerService.java -> ActivityManagerService.java:   startProcessLocked()
activate ActivityManagerService.java
note left
ActivityManagerService.java
这个方法什么也没做 3022
startProcessLocked(...){
    // 把进程创建工作委派给processList，
    // 老版本中进程创建是在AMS中，由于AMS过于臃肿，将其改造。
    // ProcessList专门负责进程创建
    return mProcessList.startProcessLocked(...);
}
end note

ActivityManagerService.java -> ProcessList.java:   mProcessList.startProcessLocked()
activate ProcessList.java
note right
ProcessList.java
//有一个非常重要参数entryPoint [1619]
//创建进程时强制指定entryPoint="android.app.ActivityThread",
//进程创建完成以后新进程入口，所有Android应用的入口是ActivityThread，并不是Application
final String entryPoint = "android.app.ActivityThread";

//进程创建之前配置必要参数，如：API类型，版本号。 1849
startProcessLocked(){
    //1953->1842
    final boolean success = startProcessLocked(app, hostingRecord, abiOverride);
}
//1842
startProcessLocked(){
    //1844->1428
    return startProcessLocked(...);
}
//1428
startProcessLocked(...){
    //1621->1640
    return startProcessLocked(...);
}
//1640
startProcessLocked(...){
    //1689->1798
    final Process.ProcessStartResult startResult = startProcess(...);
}

//创建进程完毕以后进入ZygoteProcess，此时还处于SystemServer进程
//ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。
//openZygoteSocketIfNeeded(abi)创建本地Socket对象并且连接Zygote进程Socket服务。然后通过字符输入流把创建进程必备参数发送过去
//进程创建完毕后根据新进程传递的入口类由ZygoteInit反射执行。下面进入安卓应用进程入口类ActivityThread
ZygoteProcess.java
zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);
end note

ProcessList.java -> ProcessList.java:   final Process.ProcessStartResult startResult = startProcess(...);
activate ProcessList.java
note left
ProcessList.java
//1798
startProcess(){
    //[1816]
    startResult = appZygote.getProcess().start(...)
}
end note

ProcessList.java -> ZygoteProcess.java:   final Process.ProcessStartResult startResult = appZygote.getProcess().start()
activate ZygoteProcess.java
note right
ZygoteProcess.java
ZygoteProcess作用是创建本地Socket连接对象并且连接Zygote进程Socket服务。
//314
start(...){
    //333->541
    return startViaZygote(...);
}
end note

ZygoteProcess.java -> ZygoteProcess.java:   startViaZygote()
activate ZygoteProcess.java
note left
ZygoteProcess.java
//541
startViaZygote(){
    synchronized(mLock) {
        // openZygoteSocketIfNeeded(abi)
        //创建本地Socket对象连接Zygote进程Socket服务，
        //然后通过字符输入流把创建进程必备参数发送过去,
        //进程创建后会根据新进程的入口类由ZygoteInit反射执行，
        //下面就到了Android应用入口类ActvityThread。至此Launcher进程启动流程分析完毕。
        //635
        return zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),useUsapPool,argsForZygote);
    }
}
end note

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>