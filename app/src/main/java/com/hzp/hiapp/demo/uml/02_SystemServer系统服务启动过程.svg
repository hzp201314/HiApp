<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="678.8px" preserveAspectRatio="none" style="width:391px;height:678px;" version="1.1" viewBox="0 0 391 678" width="391.6px" zoomAndPan="magnify"><defs><filter height="300%" id="favgaygoypwuk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="0.8"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="1.6" dy="1.6" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="635.7336" style="stroke:#A80036;stroke-width:0.4;" width="4" x="213" y="21.248"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="573.9195" style="stroke:#A80036;stroke-width:0.4;" width="4" x="215" y="83.0621"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="73.6105" style="stroke:#A80036;stroke-width:0.4;" width="4" x="217" y="170.7814"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="397.0879" style="stroke:#A80036;stroke-width:0.4;" width="4" x="298.2" y="259.8938"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="335.6247" style="stroke:#A80036;stroke-width:0.4;" width="4" x="300.2" y="321.3569"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="58.2632" style="stroke:#A80036;stroke-width:0.4;" width="4" x="302.2" y="598.7185"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="214.8" x2="214.8" y1="17.248" y2="660.5816"/><line style="stroke:#A80036;stroke-width:0.4;stroke-dasharray:5.0,5.0;" x1="300.2" x2="300.2" y1="17.248" y2="660.5816"/><rect fill="#FEFECE" filter="url(#favgaygoypwuk)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="42" x="193.2" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="36.4" x="196" y="11.2176">ZygoteInit.java</text><rect fill="#FEFECE" filter="url(#favgaygoypwuk)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="42" x="193.2" y="660.1816"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="36.4" x="196" y="669.3992">ZygoteInit.java</text><rect fill="#FEFECE" filter="url(#favgaygoypwuk)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.8" x="273" y="2"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="47.2" x="275.8" y="11.2176">SystemServer.java</text><rect fill="#FEFECE" filter="url(#favgaygoypwuk)" height="13.248" style="stroke:#A80036;stroke-width:0.6000000000000001;" width="52.8" x="273" y="660.1816"/><text fill="#000000" font-family="sans-serif" font-size="5.6" lengthAdjust="spacing" textLength="47.2" x="275.8" y="669.3992">SystemServer.java</text><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="635.7336" style="stroke:#A80036;stroke-width:0.4;" width="4" x="213" y="21.248"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="573.9195" style="stroke:#A80036;stroke-width:0.4;" width="4" x="215" y="83.0621"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="73.6105" style="stroke:#A80036;stroke-width:0.4;" width="4" x="217" y="170.7814"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="397.0879" style="stroke:#A80036;stroke-width:0.4;" width="4" x="298.2" y="259.8938"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="335.6247" style="stroke:#A80036;stroke-width:0.4;" width="4" x="300.2" y="321.3569"/><rect fill="#FFFFFF" filter="url(#favgaygoypwuk)" height="58.2632" style="stroke:#A80036;stroke-width:0.4;" width="4" x="302.2" y="598.7185"/><line style="stroke:#A80036;stroke-width:0.4;" x1="217" x2="235.8" y1="77.8621" y2="77.8621"/><line style="stroke:#A80036;stroke-width:0.4;" x1="235.8" x2="235.8" y1="77.8621" y2="83.0621"/><line style="stroke:#A80036;stroke-width:0.4;" x1="219.4" x2="235.8" y1="83.0621" y2="83.0621"/><polygon fill="#A80036" points="223.4,81.4621,219.4,83.0621,223.4,84.6621,221.8,83.0621" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="221.8" y="75.9195">1</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="14.4" x="226.2" y="75.9195">main()</text><path d="M3.2,23.248 L3.2,133.648 L209.2,133.648 L209.2,27.248 L205.2,23.248 L3.2,23.248 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M205.2,23.248 L205.2,27.248 L209.2,27.248 L205.2,23.248 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="5.6" y="31.2072">ZygoteInit.java 819</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="85.2" x="5.6" y="38.309">public static void main(String argv[]) {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="126.4" x="12" y="45.4107">//1.系统资源预加载 877 preload(bootTimingsTraceLog);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88" x="12" y="52.5125">preloadClasses();//加载系统Class文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="91.2" x="12" y="59.6143">preloadResources();//加载系统资源文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="97.2" x="12" y="66.716">preloadSharedLibraries();//加载系统动态库</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="191.2" x="12" y="73.8178">//2.启动system_server进程。SystemServer进程是Android Framework的核心进程。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="90.8" x="12" y="80.9195">if(argv[1].equals("start-system-server")){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="18.4" y="88.0213">startSystemServer();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="12" y="95.123">}</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="172.8" x="12" y="102.2248">//3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54" x="12" y="109.3266">registerZygoteSocket();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="160.4" x="12" y="116.4283">//4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="50.8" x="12" y="123.5301">runSelectLoopMode();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="5.6" y="130.6318">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="219" x2="237.8" y1="165.5814" y2="165.5814"/><line style="stroke:#A80036;stroke-width:0.4;" x1="237.8" x2="237.8" y1="165.5814" y2="170.7814"/><line style="stroke:#A80036;stroke-width:0.4;" x1="221.4" x2="237.8" y1="170.7814" y2="170.7814"/><polygon fill="#A80036" points="225.4,169.1814,221.4,170.7814,225.4,172.3814,223.8,170.7814" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="223.8" y="163.6389">2</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="69.2" x="228.2" y="163.6389">preload(bootTimingsTraceLog)</text><path d="M97.2,139.3744 L97.2,192.9744 L209.2,192.9744 L209.2,143.3744 L205.2,139.3744 L97.2,139.3744 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M205.2,139.3744 L205.2,143.3744 L209.2,143.3744 L205.2,139.3744 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="32.8" x="99.6" y="147.3336">ZygoteInit.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="21.6" x="99.6" y="154.4354">preload(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="44" x="106" y="161.5371">//1.系统资源预加载</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88" x="106" y="168.6389">preloadClasses();//加载系统Class文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="91.2" x="106" y="175.7406">preloadResources();//加载系统资源文件</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="97.2" x="106" y="182.8424">preloadSharedLibraries();//加载系统动态库</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="99.6" y="189.9441">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="221" x2="237.8" y1="206.1885" y2="206.1885"/><line style="stroke:#A80036;stroke-width:0.4;" x1="237.8" x2="237.8" y1="206.1885" y2="211.3885"/><line style="stroke:#A80036;stroke-width:0.4;" x1="221.4" x2="237.8" y1="211.3885" y2="211.3885"/><polygon fill="#A80036" points="225.4,209.7885,221.4,211.3885,225.4,212.9885,223.8,211.3885" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="223.8" y="204.2459">3</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="38.8" x="228.2" y="204.2459">preloadClasses()</text><line style="stroke:#A80036;stroke-width:0.4;" x1="221" x2="237.8" y1="224.0902" y2="224.0902"/><line style="stroke:#A80036;stroke-width:0.4;" x1="237.8" x2="237.8" y1="224.0902" y2="229.2902"/><line style="stroke:#A80036;stroke-width:0.4;" x1="221.4" x2="237.8" y1="229.2902" y2="229.2902"/><polygon fill="#A80036" points="225.4,227.6902,221.4,229.2902,225.4,230.8902,223.8,229.2902" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="223.8" y="222.1477">4</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="44.8" x="228.2" y="222.1477">preloadResources()</text><line style="stroke:#A80036;stroke-width:0.4;" x1="221" x2="237.8" y1="243.992" y2="243.992"/><line style="stroke:#A80036;stroke-width:0.4;" x1="237.8" x2="237.8" y1="243.992" y2="249.192"/><line style="stroke:#A80036;stroke-width:0.4;" x1="219" x2="237.8" y1="249.192" y2="249.192"/><polygon fill="#A80036" points="223,247.592,219,249.192,223,250.792,221.4,249.192" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="223.8" y="242.0494">5</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="228.2" y="242.0494">preloadSharedLibraries()</text><polygon fill="#A80036" points="293.4,258.2938,297.4,259.8938,293.4,261.4938,295,259.8938" style="stroke:#A80036;stroke-width:0.4;"/><line style="stroke:#A80036;stroke-width:0.4;" x1="219" x2="295.8" y1="259.8938" y2="259.8938"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="221.8" y="257.9512">6</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="46" x="226.2" y="257.9512">startSystemServer()</text><line style="stroke:#A80036;stroke-width:0.4;" x1="302.2" x2="321" y1="316.1569" y2="316.1569"/><line style="stroke:#A80036;stroke-width:0.4;" x1="321" x2="321" y1="316.1569" y2="321.3569"/><line style="stroke:#A80036;stroke-width:0.4;" x1="304.6" x2="321" y1="321.3569" y2="321.3569"/><polygon fill="#A80036" points="308.6,319.7569,304.6,321.3569,308.6,322.9569,307,321.3569" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="307" y="314.2144">7</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="77.6" x="311.4" y="314.2144">main()-&gt;new SystemServer().run()</text><path d="M159.2,265.0938 L159.2,368.2938 L294.4,368.2938 L294.4,269.0938 L290.4,265.0938 L159.2,265.0938 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M290.4,265.0938 L290.4,269.0938 L294.4,269.0938 L290.4,265.0938 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="94" x="161.6" y="273.0529">SystemServer.java main():348-&gt;run():370</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="44.4" x="161.6" y="280.1547">private void main() {</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="66" x="168" y="287.2564">Looper.prepareMainLooper();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="66.8" x="168" y="294.3582">// 创建系统服务的管理者 497</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="120.4" x="168" y="301.46">SystemServiceManager mSystemServiceManager =</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="110.8" x="168" y="308.5617">new SystemServiceManager(mSystemContext);</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="54.4" x="168" y="315.6635">//1.启动引导服务17 510</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="57.2" x="168" y="322.7652">startBootstrapServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="51.6" x="168" y="329.867">//2.启动核心服务9 511</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="168" y="336.9688">startCoreServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="68" x="168" y="344.0705">//3.启动其他一般服务90+ 512</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="168" y="351.1723">startOtherServices();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="31.6" x="168" y="358.274">Looper.loop();</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="161.6" y="365.3758">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="304.2" x2="321" y1="416.5289" y2="416.5289"/><line style="stroke:#A80036;stroke-width:0.4;" x1="321" x2="321" y1="416.5289" y2="421.7289"/><line style="stroke:#A80036;stroke-width:0.4;" x1="304.6" x2="321" y1="421.7289" y2="421.7289"/><polygon fill="#A80036" points="308.6,420.1289,304.6,421.7289,308.6,423.3289,307,421.7289" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="307" y="414.5863">8</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="55.6" x="311.4" y="414.5863">startBootstrapServices()</text><path d="M2,374.1184 L2,456.1184 L294.8,456.1184 L294.8,378.1184 L290.8,374.1184 L2,374.1184 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M290.8,374.1184 L290.8,378.1184 L294.8,378.1184 L290.8,374.1184 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="4.4" y="382.0775">SystemServer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="48.4" x="4.4" y="389.1793">//启动引导服务(17个)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="57.2" x="4.4" y="396.2811">startBootstrapServices(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="278" x="10.8" y="403.3828">ActivityManagerService：为四大组件提供调度服务，其中Activity调度交由ATMS(ActivityTaskManagerService)(Android10)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="107.6" x="10.8" y="410.4846">ActivityTaskManagerService：Activity调度服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="118.4" x="10.8" y="417.5863">PackageManager：提供安装，卸载，扫描管理服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="98" x="10.8" y="424.6881">PowerManagerService：提供电源管理服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="105.6" x="10.8" y="431.7898">UriGrantsManagerService：权限申请授权服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="92.4" x="10.8" y="438.8916">OtaDexoptService：Dex字节码优化服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="10.8" y="445.9934">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="4.4" y="453.0951">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="304.2" x2="321" y1="497.1465" y2="497.1465"/><line style="stroke:#A80036;stroke-width:0.4;" x1="321" x2="321" y1="497.1465" y2="502.3465"/><line style="stroke:#A80036;stroke-width:0.4;" x1="304.6" x2="321" y1="502.3465" y2="502.3465"/><polygon fill="#A80036" points="308.6,500.7465,304.6,502.3465,308.6,503.9465,307,502.3465" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="2.8" x="307" y="495.2039">9</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="44" x="311.4" y="495.2039">startCoreServices()</text><path d="M162.8,461.8377 L162.8,529.4377 L294.4,529.4377 L294.4,465.8377 L290.4,461.8377 L162.8,461.8377 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M290.4,461.8377 L290.4,465.8377 L294.4,465.8377 L290.4,461.8377 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="165.2" y="469.7969">SystemServer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="165.2" y="476.8986">//系统核心服务(9个)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="45.6" x="165.2" y="484.0004">startCoreServices(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="90.8" x="171.6" y="491.1021">BatteryService：提供电池状态管理服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="103.2" x="171.6" y="498.2039">WebViewUpdateService：WebView升级服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="75.6" x="171.6" y="505.3057">GPUService：GPU驱动加载服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="116.8" x="171.6" y="512.4074">UsageStatsService：应用对系统资源使用记录服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="171.6" y="519.5092">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="165.2" y="526.6109">}</text><line style="stroke:#A80036;stroke-width:0.4;" x1="304.2" x2="323" y1="593.5185" y2="593.5185"/><line style="stroke:#A80036;stroke-width:0.4;" x1="323" x2="323" y1="593.5185" y2="598.7185"/><line style="stroke:#A80036;stroke-width:0.4;" x1="306.6" x2="323" y1="598.7185" y2="598.7185"/><polygon fill="#A80036" points="310.6,597.1185,306.6,598.7185,310.6,600.3185,309,598.7185" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" font-weight="bold" lengthAdjust="spacing" textLength="5.6" x="309" y="591.5759">10</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="46" x="316.2" y="591.5759">startOtherServices()</text><path d="M180,535.3535 L180,652.9535 L294.4,652.9535 L294.4,539.3535 L290.4,535.3535 L180,535.3535 " fill="#FBFB77" filter="url(#favgaygoypwuk)" style="stroke:#A80036;stroke-width:0.4;"/><path d="M290.4,535.3535 L290.4,539.3535 L294.4,539.3535 L290.4,535.3535 " fill="#FBFB77" style="stroke:#A80036;stroke-width:0.4;"/><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="42.8" x="182.4" y="543.3127">SystemServer.java</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="66.8" x="182.4" y="550.4145">//启动其他一般服务(90+) 877</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="47.6" x="182.4" y="557.5162">startOtherServices(){</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="86.8" x="188.8" y="564.618">AlarmManagerService：提供时钟服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="86" x="188.8" y="571.7197">NetWorkStatsService：网络状态服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="91.6" x="188.8" y="578.8215">WindowManagerService：窗口管理服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="65.2" x="188.8" y="585.9232">TelephonyRegister:电话服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="91.2" x="188.8" y="593.025">InputMethodManagerService：输入服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="64.8" x="188.8" y="600.1268">BluetoothService：蓝牙服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="88.4" x="188.8" y="607.2285">NotificationManagerService：通知服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="56" x="188.8" y="614.3303">AudioService：音频服务</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="188.8" y="621.432">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="78.8" x="188.8" y="628.5338">//启动Launcher应用入口方法 2035</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="99.6" x="188.8" y="635.6355">mActivityManagerService.systemReady(...)</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="4.8" x="188.8" y="642.7373">...</text><text fill="#000000" font-family="sans-serif" font-size="5.2" lengthAdjust="spacing" textLength="1.6" x="182.4" y="649.8391">}</text><!--MD5=[9cf74633e0591252239dca79416d985a]
@startuml
'https://plantuml.com/sequence-diagram

autonumber

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: main()
note left
ZygoteInit.java 819
public static void main(String argv[]) {
    //1.系统资源预加载 877 preload(bootTimingsTraceLog);
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
    //2.启动system_server进程。SystemServer进程是Android Framework的核心进程。
    if(argv[1].equals("start-system-server")){
        startSystemServer();
    }
    //3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求
    registerZygoteSocket();
    //4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。
    runSelectLoopMode();
}
end note

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: preload(bootTimingsTraceLog)
note left
ZygoteInit.java
preload(){
    //1.系统资源预加载
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
}
end note

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: preloadClasses()
ZygoteInit.java -> ZygoteInit.java: preloadResources()
ZygoteInit.java -> ZygoteInit.java: preloadSharedLibraries()
deactivate ZygoteInit.java

ZygoteInit.java -> SystemServer.java: startSystemServer()
activate SystemServer.java

SystemServer.java -> SystemServer.java:  main()->new SystemServer().run()
activate SystemServer.java
note left
SystemServer.java main():348->run():370
private void main() {
    Looper.prepareMainLooper();
    // 创建系统服务的管理者 497
    SystemServiceManager mSystemServiceManager =
    new SystemServiceManager(mSystemContext);
    //1.启动引导服务17 510
    startBootstrapServices();
    //2.启动核心服务9 511
    startCoreServices();
    //3.启动其他一般服务90+ 512
    startOtherServices();
    Looper.loop();
}
end note


SystemServer.java -> SystemServer.java:  startBootstrapServices()
note left
SystemServer.java
//启动引导服务(17个)
startBootstrapServices(){
    ActivityManagerService：为四大组件提供调度服务，其中Activity调度交由ATMS(ActivityTaskManagerService)(Android10)
    ActivityTaskManagerService：Activity调度服务
    PackageManager：提供安装，卸载，扫描管理服务
    PowerManagerService：提供电源管理服务
    UriGrantsManagerService：权限申请授权服务
    OtaDexoptService：Dex字节码优化服务
    ...
}
end note

SystemServer.java -> SystemServer.java:  startCoreServices()
note left
SystemServer.java
//系统核心服务(9个)
startCoreServices(){
    BatteryService：提供电池状态管理服务
    WebViewUpdateService：WebView升级服务
    GPUService：GPU驱动加载服务
    UsageStatsService：应用对系统资源使用记录服务
    ...
}
end note

SystemServer.java -> SystemServer.java:  startOtherServices()
activate SystemServer.java
note left
SystemServer.java
//启动其他一般服务(90+) 877
startOtherServices(){
    AlarmManagerService：提供时钟服务
    NetWorkStatsService：网络状态服务
    WindowManagerService：窗口管理服务
    TelephonyRegister:电话服务
    InputMethodManagerService：输入服务
    BluetoothService：蓝牙服务
    NotificationManagerService：通知服务
    AudioService：音频服务
    ...
    //启动Launcher应用入口方法 2035
    mActivityManagerService.systemReady(...)
    ...
}
end note

@enduml

@startuml

autonumber

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: main()
note left
ZygoteInit.java 819
public static void main(String argv[]) {
    //1.系统资源预加载 877 preload(bootTimingsTraceLog);
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
    //2.启动system_server进程。SystemServer进程是Android Framework的核心进程。
    if(argv[1].equals("start-system-server")){
        startSystemServer();
    }
    //3.创建Socket服务,用来接受来自ActivityManagerService申请进程创建请求
    registerZygoteSocket();
    //4.Socket创建完成后会进入阻塞状态，等待AMS申请进程创建请求。
    runSelectLoopMode();
}
end note

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: preload(bootTimingsTraceLog)
note left
ZygoteInit.java
preload(){
    //1.系统资源预加载
    preloadClasses();//加载系统Class文件
    preloadResources();//加载系统资源文件
    preloadSharedLibraries();//加载系统动态库
}
end note

activate ZygoteInit.java
ZygoteInit.java -> ZygoteInit.java: preloadClasses()
ZygoteInit.java -> ZygoteInit.java: preloadResources()
ZygoteInit.java -> ZygoteInit.java: preloadSharedLibraries()
deactivate ZygoteInit.java

ZygoteInit.java -> SystemServer.java: startSystemServer()
activate SystemServer.java

SystemServer.java -> SystemServer.java:  main()->new SystemServer().run()
activate SystemServer.java
note left
SystemServer.java main():348->run():370
private void main() {
    Looper.prepareMainLooper();
    // 创建系统服务的管理者 497
    SystemServiceManager mSystemServiceManager =
    new SystemServiceManager(mSystemContext);
    //1.启动引导服务17 510
    startBootstrapServices();
    //2.启动核心服务9 511
    startCoreServices();
    //3.启动其他一般服务90+ 512
    startOtherServices();
    Looper.loop();
}
end note


SystemServer.java -> SystemServer.java:  startBootstrapServices()
note left
SystemServer.java
//启动引导服务(17个)
startBootstrapServices(){
    ActivityManagerService：为四大组件提供调度服务，其中Activity调度交由ATMS(ActivityTaskManagerService)(Android10)
    ActivityTaskManagerService：Activity调度服务
    PackageManager：提供安装，卸载，扫描管理服务
    PowerManagerService：提供电源管理服务
    UriGrantsManagerService：权限申请授权服务
    OtaDexoptService：Dex字节码优化服务
    ...
}
end note

SystemServer.java -> SystemServer.java:  startCoreServices()
note left
SystemServer.java
//系统核心服务(9个)
startCoreServices(){
    BatteryService：提供电池状态管理服务
    WebViewUpdateService：WebView升级服务
    GPUService：GPU驱动加载服务
    UsageStatsService：应用对系统资源使用记录服务
    ...
}
end note

SystemServer.java -> SystemServer.java:  startOtherServices()
activate SystemServer.java
note left
SystemServer.java
//启动其他一般服务(90+) 877
startOtherServices(){
    AlarmManagerService：提供时钟服务
    NetWorkStatsService：网络状态服务
    WindowManagerService：窗口管理服务
    TelephonyRegister:电话服务
    InputMethodManagerService：输入服务
    BluetoothService：蓝牙服务
    NotificationManagerService：通知服务
    AudioService：音频服务
    ...
    //启动Launcher应用入口方法 2035
    mActivityManagerService.systemReady(...)
    ...
}
end note

@enduml

PlantUML version 1.2021.00(Sun Jan 10 18:25:05 CST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>